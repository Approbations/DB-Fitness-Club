# Описание
## Наименование
Авангард - система для управления фитнес-клубом, онлайн записями, учетом инвентаря.
## Предметная область
Предметная область охватывает управление клиентами и их абонементами, расписанием групповых занятий, персоналом, оборудованием и отслеживание посещений. Ключевая функция — предоставление клиентам удобного веб-интерфейса для записи на занятия и управления своим членством.
# Данные
## Логика проектирования базы данных
Изначально эта база данных задумывалась как помощь администратору фитнесс зала. Администратор должен:
- следить за абонементами посетителей;
- работой и зарплатами сотрудников;
- вправе назначать тренировки и тренеров на них;
- следить за исправностью обслуживания инвентаря.

Отсюда появляются таблицы: *client, gym_membership, schedule, staff, equipment, class*.

 В таблице *client* мы храним его индивидуальный номер (должен присваиваться при регестрации в зал), имя, фамилия, дата рождения и номер абонемента.

Абонементы стоят по разному и имеют различные временные промежутки для их реализации (уровень абонемента клиента указывается в *gym_membership.level*). Для каждого клиента указывается дата начала и окончания действия абонемента. Описание для каждого уровня осуществляется в таблице *levels*.

Клиент имеет **активный** абонемент (без него он не может заниматься). Пользователь может отмечаться сколько времени он провел в спортзале. За это отвечает таблица *client_visit*. Клиент из личного кабинета может записаться на интересующее его занятие или же отменить бронирование (таблица *booking*).

Таблица *schedule* отвечает за расписание занятий, в ней указывается тренер, то в каком зале это будет проходить, время начала и окончания. Могут проводиться различные занятия в клубе, например йога, групповые тренировки на беговых дорожках, растяжки, тягание тяжестей и многое другое. Пользуемся таблицей class, в которой также указано сколько человек может учавствать и описание тренировки.
В таблице *schedule* также можно будет назначать индивидуальные тренировки с тренером.

У каждого работника фитнесс клуба указывается имя, фамилия, должностть, зарплата и дата наёма сотрудника (таблица *staff*).

Инвентарь используется не только в основном зале, но и на тренировках (таблица *equipment_usage*), но не весь инвентарь нуждается в регулярном обслуживании. Например гантели могут служить годами, а беговая дорожка может ломаться каждые 2 месяца и нуждаться в ремонте. Здесь возникает таблица *equipment_service и equipment_type*, для каждого типа инвентаря указывается временной промежуток (в днях), когда необходимо проверить на работоспособность, поломки, дефекты инвентарь.

Если условную беговую дорожку всё же пришлось чинить, то благодаря табице *equipment* можно описать по какой причине произошла поломка, когда был последний ремонт, и когда была введена в эксплуатацию.

## Основные сценарии пользования

- *Регистрация нового клиента*

    Создание профиля клиента;\
    Выбор и активация абонемента.

- *Управление занятиями*

    Администратор создает расписание занятий;\
    Система проверяет доступность зала и тренера;\
    Клиенты записываются на доступные занятия;\
    Отслеживание заполненности групп.

- *Посещение клуба*

    Клиент отмечается при входе/выходе;\
    Система проверяет активный абонемент;\
    Фиксация времени посещения.

- *Управление оборудованием*

    Плановое обслуживание инвентаря;\
    Отслеживание поломок и ремонтов;\
    Учет использования оборудования на занятиях.

## Примеры сценариев
Сценарий 1: Запись клиента на занятие
1. Клиент авторизуется в системе;
2. Система проверяет активный абонемент (gym_membership);
3. Клиент выбирает занятие из расписания (schedule);
4. Система проверяет доступность мест;
5. Создается запись в booking;

Сценарий 2: Обслуживание оборудования
1. Система генерирует отчет по equipment с просроченным обслуживанием;
2. Техник проводит обслуживание;
3. Обновляется equipment.last_service;
4. Создается запись в equipment_maintenance.

## Нормализация базы данных:

client и gym_membership разделены, так как один клиент может иметь несколько абонементов в разное время.

levels выделена для избежания дублирования данных о типах абонементов.

equipment_type отделена от equipment для нормализации данных о типах оборудования.

## Основные связи

client (1) ←→ (N) gym_membership - Один клиент может иметь несколько абонементов в разное время.

gym_membership (N) ←→ (1) levels - Каждый абонемент относится к одному уровню.

schedule (N) ←→ (1) class - Одно занятие может быть в расписании много раз.

schedule (N) ←→ (1) staff - Один тренер может проводить много занятий.

schedule (1) ←→ (N) equipment_usage - На одном занятии может использоваться несколько единиц оборудования.

![Диаграмма базы данных](db_diagramm.png)
## Для каждого элемента данных - ограничения

### client - клиенты клуба
|Название поля|Тип|Ограничения|
|:-|:-:|:-|
|id|UUID|PRIMARY KEY|
|first_name|VARCHAR(255)|Отсутствие цифр и специальных символов, NOT NULL|
|last_name|VARCHAR(255)|Отсутствие цифр и специальных символов, NOT NULL|
|birth_date|DATE|Возраст клиента от 16 лет, NOT NULL|
|email|VARCHAR(255)|UNIQUE, NOT NULL|

### gym_membership - членство клуба (абонемент)
|Название поля|Тип|Ограничения|
|:-|:-:|:-|
|id|UUID|PRIMARY KEY|
|id_client|UUID|FOREIGN KEY -> client.id|
|created_date|DATE|NOT NULL|
|start_date|DATE|NOT NULL|
|level|INTEGER|FOREIGN KEY -> levels.id, NOT NULL|
|status|VARCHAR(255)|NOT NULL, значения: active, expired,cancelled|

### levels - уровень абонемента
|Название поля|Тип|Ограничения|
|:-|:-:|:-|
|id|INTEGER|PRIMARY KEY, AUTOINCREMENT|
|name|VARCHAR(255)|NOT NULL, значения: пробный, базовый, бизнес,  премиум|
|duration|INTEGER|NOT NULL, >= 1 день|
|price|DECIMAL|NOT NULL, >= 0|

### equipment - спортивный инвентарь
|Название поля|Тип|Ограничения|
|:-|:-:|:-|
|id|INTEGER|PRIMARY KEY, AUTOINCREMENT|
|start_of_operation|DATE|NOT NULL|
|id_type|INTEGER|FOREIGN KEY -> equipment_type.id, NOT NULL|

### equipment_service - обслуживание инвентаря
|Название поля|Тип|Ограничения|
|:-|:-:|:-|
|id|SERIAL|PRIMARY KEY|
|id_equipment|INTEGER|NOT NULL, FOREIGN KEY -> equipment.id|
|service_date|DATE|NOT NULL|
|next_service_date|DATE|NOT NULL|
|notes|TEXT|Может отстутствовать|
|cost|DECIMAL|NOT NULL|

### equipment_type - тип инвентаря
|Название поля|Тип|Ограничения|
|:-|:-:|:-|
|id|INTEGER|PRIMARY KEY, AUTOINCREMENT|
|name|VARCHAR(255)|NOT NULL, UNIQUE (например: гантель 10 кг, беговая дорожка, велотренажер)|
|service_interval|INTEGER|Может отсутствовать|

### staff - персонал
|Название поля|Тип|Ограничения|
|:-|:-:|:-|
|id|UUID|PRIMARY KEY|
|first_name|VARCHAR(255)|Отсуствие цифр и специальных символов, NOT NULL|
|last_name|VARCHAR(255)|Отсуствие цифр и специальных символов, NOT NULL|
|position|VARCHAR(255)|NOT NULL, значения: тренер, администратор, уборщик, инструктор, мастер|
|salary|DECIMAL|> 0.00|
|hire_date|DATE|NOT NULL|

### client_visit - посещение клиента
|Название поля|Тип|Ограничения|
|:-|:-:|:-|
|id|INTEGER|PRIMARY KEY, AUTOINCREMENT|
|id_client|UUID|FOREIGN KEY -> client.id, NOT NULL|
|check_in|TIMESTAMPZ|NOT NULL|
|check_out|TIMESTAMPZ|>= check_in|
|id_membership|UUID|FOREIGN KEY -> gym_membership.id|

### class - тренировка
|Название поля|Тип|Ограничения|
|:-|:-:|:-|
|id|INTEGER|PRIMARY KEY, AUTOINCREMENT|
|name|VARCHAR(255)|NOT NULL, UNIQUE (например: йога, пилатесс, кроссфит)|
|description|TEXT|Может отсутствовать|
|max_clients|INTEGER|1 <= x <= 50|
|is_individual|BOOLEAN|NOT NULL|

### schedule - расписание тренировок
|Название поля|Тип|Ограничения|
|:-|:-:|:-|
|id|INTEGER|PRIMARY KEY, AUTOINCREMENT|
|id_class|INTEGER|FOREIGN KEY -> class.id, NOT NULL|
|id_trainer|UUID|FOREIGN KEY -> staff.id, NOT NULL|
|start_class|TIMESTAMPZ|NOT NULL|
|end_class|TIMESTAMPZ|NOT NULL, > start_class|
|room|INTEGER|NOT NULL, FOREIGN KEY -> room.id|

### room - зал в котором проводятся занятия
|Название поля|Тип|Ограничения|
|:-|:-:|:-|
|id|INTEGER|PRIMARY KEY|
|name|VARCHAR(255)|NOT NULL|
|capacity|INTEGER|NOT NULL, > 0|

### equipment_usage - использование инвентаря
|Название поля|Тип|Ограничения|
|:-|:-:|:-|
|id|INTEGER|PRIMARY KEY, AUTOINCREMENT|
|id_class_schedule|INTEGER|FOREIGN KEY -> schedule.id, NOT NULL|
|id_equipment|INTEGER|FOREIGN KEY -> equipment.id, NOT NULL|
|quantity|INTEGER|>= 1|

### booking - запись на тренировки
|Название поля|Тип|Ограничения|
|:-|:-:|:-|
|id|UUID|PRIMARY KEY|
|id_client|UUID|FOREIGN KEY -> client.id, NOT NULL|
|id_schedule|INTEGER|FOREIGN KEY -> schedule.id, NOT NULL|
|booking_date|TIMESTAMPZ|NOT NULL, DEFAULT NOW()|
|status_booking|VARCHAR(255)|NOT NULL, значения: confirmed, cancelled, visited, no_show|
Индекс UNIQUE (id_client, id_schedule)
## Общие ограничения целостности
- *Клиент должен иметь активную подписку для посещения*

    В client_visit проверять, что gym_membership.status = 'active'

- *Нельзя назначить занятие в прошлом*
    
    schedule.start_class ≥ CURRENT_TIMESTAMP

- *Один тренер не может проводить два занятия одновременно*

    Проверка пересечения времён в schedule для одного id_trainer

- *Максимальное количество клиентов в классе*
    
    При записи на занятие проверять: COUNT(client_visit WHERE id_class_schedule = X) < class.max_clients

- *Оборудование должно быть в рабочем состоянии*

    Если last_service + service_interval < CURRENT_DATE — считать оборудование требующим обслуживания

- *Клиент не может записаться на занятие дважды*

- *Время работы тренера должно пересекаться с его занятиями*

- *Клиент может посещать зал в любое время и больше раза в день*

- *Абонементы выдаются на некоторое количество дней в зависимости от уровня абонемента*

- *Стоимость определяется из базовых тарифов, они фикисированы*
# Пользовательские роли
- *Клиент*

    Может записываться на занятия, совершать действия над абониментом (покупка, замораживание и т.д.).
    Количество: 100-1000 человек.
- *Тренер*

    Просмотр и управление своим расписанием занятий.
    Количество: 10-20 человек.
- *Администратор*

    Полное управление системой: клиенты, тренера, абонементы, типы занятий, расписания, оборудования.
    Количество: 2-5 человек.
- *Менеджер по оборудованию*

    Просмотр отчетов по обслуживанию, планирование ремонтов.
    Количество: 2-5 человек.

- *Бухгалтер*

    Отчеты по продажам абонементов, зарплатам тренеров.
    Количество: 1-3 человека.

# UI / API 
*UI (Пользовательский интерфейс):*
Публичный сайт (для клиентов): Личный кабинет с расписанием, возможностью записи/отмены занятий.

*API (Интерфейс программирования приложений):*
Фрейморк FastAPI для написания backend.
Встроенный ASGI-сервер Uvicorn.
Frontend будет написан с помощью React. Связь с backend будет осуществляться REST API.
# Технологии разработки
## Язык программирования
Приложение будет написано на языке программирования Python версии 3.10. 
## СУБД
RostgreSQL
# Тестирование
Unit Tests с помощью фреймворка pytest.

Тестирование безопасности, например доступ клиента к возможностям администратора.